**I. The "DO NOT" Items (Prohibitions & Constraints - Monorepo Focus)**
1.  **DO NOT VIOLATE THE CONSTITUTION.** The `DOCTRINE.md` and `WORKFLOWS.md` are the absolute law. All architectural decisions, configurations, and workflows must be subordinate to them. This is the final arbiter in any debate.
2.  **DO NOT COMPROMISE THE MANIFEST STANDARDIZATION AGREEMENT.** The architectural decision is final: root manifest is `package.json`, package manifests are `package.jsonc` (enabled via `.npmrc`). This standard must be upheld without exception.
3.  **DO NOT REVERT TO CONVENTIONAL DIRECTORY STRUCTURES.** The `shuffrand` package's unique, minimalist, folderless file structure (`src.*.ts`, `test.*.ts`) is a deliberate architectural choice (Doctrine #9). Tooling must adapt to it; the structure must not be altered.
4.  **DO NOT WEAKEN THE PREFLIGHT WORKFLOW'S INTEGRITY.** The project's quality gate is the powerful, atomic `format -> lint -> [clean -> build -> compile -> test]` sequence. Do not propose replacing it with a less robust alternative. Protect this sacred sequence.
5.  **DO NOT FRAGMENT TOOLING CONFIGURATION.** All primary tooling configurations (`ESLint`, `Vite`, `Vitest`, `TypeScript`, `Playwright`) must reside at the monorepo root. Decentralization of core tooling config is forbidden to maintain DRY and a single source of truth.
6.  **DO NOT CONFLATE OR MIX TESTSUITE GROUPS.** The project has three distinct, intentionally separate testsuite groups (Unit, E2E/Regression/End-user/Production, PerformanceBenchmark/Timing). Their boundaries are sacred. The primary `pnpm test` must *never* trigger secondary (E2E) or tertiary (Benchmark) suites. Keep the default quality gate fast.
7.  **DO NOT DECLARE WORKSPACES IN `package.json`.** The `pnpm-workspace.yaml` file is the single source of truth for workspace package locations. Never declare workspaces using the `workspaces` field in `package.json` or `package.jsonc`. This avoids conflicts and ensures clarity.
8.  **DO NOT NEGLECT `pnpm-workspace.yaml` MAINTENANCE.** Whenever a new package is added to the monorepo, its path *must* be explicitly added to the `packages` array in `pnpm-workspace.yaml`. Failure to do so will result in `pnpm` not recognizing the package, leading to "No projects found" or dependency resolution errors.
9.  **DO NOT IGNORE `pnpm` WORKSPACE WARNINGS OR ERRORS.** `pnpm` provides specific warnings and errors related to workspace setup (e.g., `No projects found`, version conflicts, peer dependency issues). These are *critical* indicators of fundamental issues with the monorepo structure or dependency management that *must* be resolved directly. Do not silence or work around them.
10. **DO NOT CREATE REDUNDANT OR CONFLICTING CONFIGURATION FILES.** Avoid duplicating configuration logic or creating files with similar purposes in different locations (e.g., having both `tsconfig.json` and `tsconfig.base.json` at the root with overlapping settings unless strictly necessary for inheritance). Do not create package-level configuration files that duplicate or contradict root-level configurations unless there's a clear, documented reason for the override.
11. **DO NOT CLUTTER THE ROOT WITH PACKAGE-SPECIFIC ARTIFACTS.** The monorepo root directory must *not* contain build outputs (`dist/`), test results (`test-results/`), reports (`reports/`), or temporary files (`node_modules/` is an exception managed by `pnpm`) that originate from individual packages. All such artifacts must be generated within their respective package directories (`shuffrand/dist/`, `shuffrand/reports/`, etc.) or directed to a designated, centralized output directory like `reports/` at the root *only if explicitly configured to do so by root-level tooling*.
12. **DO NOT BREAK THE "TEST THE FINAL PRODUCT" PHILOSOPHY DURING INTERNAL TESTING.** While E2E tests validate the final product in a browser, unit tests (`pnpm test`) must also validate the *final compiled output* (`dist/`). Never test raw source files directly in unit tests; always test against the compiled artifacts to ensure the build process doesn't introduce errors.
13. **DO NOT HARD-CODE ABSOLUTE OR FRAGILE RELATIVE PATHS IN CONFIGURATIONS.** Use `path.resolve(__dirname, ...)` or similar Node.js path utilities in configuration files (`vite.config.ts`, `vitest.config.ts`) to construct paths dynamically and robustly. This prevents breakage if the project structure changes slightly or if the config file is moved.
14. **DO NOT PERMIT TYPE-CHECKING TO SILENTLY FAIL.** Ensure `tsc` (or equivalent type checking step) is part of the `preflight` script and runs successfully with zero errors. Type safety is paramount. A single unchecked `any` or unresolved module can lead to runtime failures.
15. **DO NOT COMMIT CODE THAT FAILS THE FULL VALIDATION GAUNTLET.** A "pass" is not subjective. The local refactor is only complete when the *entire* validation sequence succeeds: `pnpm run preflight` (format, lint, clean, build, compile, test), `pnpm run test:e2e`, `pnpm run test:benchmark`. Zero errors, zero warnings.

**II. The "DO" Items (Mandates & Best Practices - Monorepo Focus)**
1.  **DO PROVIDE COMPLETE, DEFINITIVE, COPY-PASTE-READY SOLUTIONS.** This is paramount. Do not provide partial snippets or diffs. Provide the entire, final, correct content for any file that needs changing (except `package.json` scripts where surgical changes are acceptable).
2.  **DO OPERATE WITH SURGICAL PRECISION: ONE FILE, ONE STEP AT A TIME.** Present solutions meticulously, step-by-step. Propose a change for a *single file*, provide complete content, explain the brutal, honest rationale, *await explicit confirmation*, then proceed to the next file. This prevents cascade failures.
3.  **DO INSIST ON GROUND TRUTH; NEVER GUESS FILE CONTENTS.** If uncertain about a file's current state, you *must* ask for its complete, current content before proposing a change. Basing solutions on assumptions or stale information is the primary cause of failures. Always verify the actual state.
4.  **DO THINK SYSTEMICALLY AND JUSTIFY WITH BRUTAL HONESTY.** Every proposed solution must be accompanied by a clear, honest rationale explaining *why* it's necessary within the *entire toolchain context* (`pnpm`, `TypeScript`, `Vite`, `Vitest`, `ESLint`). Acknowledge and learn from past failures. Connect the dots.
5.  **DO RESPECT "YESTERDAY'S LOGIC" (github.com/DoronBrayer/shuffrand/tree/v1.7.0) AS THE TRUSTED FOUNDATION.** The pre-monorepo configuration "worked like a charm." New configurations must be a direct, logical evolution, adapting that proven state for the monorepo. Leverage past successes.
6.  **DO UTILIZE THE FULL, IDIOMATIC POWER OF THE TOOLCHAIN.** Leverage modern tools correctly: `pnpm -r`, `pnpm --filter`, TypeScript project references, Vite/Vitest ESM features, Playwright's capabilities. Use the right tool for the job in the prescribed way.
7.  **DO WRITE CONFIGURATION AS CODE WITH CLARITY AND MAINTAINABILITY.** Configuration files are not static data. They are programs. Use variables (`const REPORTS_DIR = ...`) to stay DRY. Write abundant, clear comments explaining *why* a setting exists, not just *what* it does. Structure them for readability.
8.  **DO DEFINE PACKAGES EXPLICITLY IN `pnpm-workspace.yaml`.** The list of packages within the `monorand` monorepo must be explicitly declared in the root `pnpm-workspace.yaml` file using clear, unambiguous paths (e.g., `- 'shuffrand'`, `- 'datrand'`). Relying on implicit discovery or conflicting mechanisms is forbidden.
9.  **DO ALIGN TYPESCRIPT PROJECT REFERENCES WITH MONOREPO STRUCTURE.** Use `references` in the root `tsconfig.json` to link to package `tsconfig.json` files. Ensure package `tsconfig.json` files have a clean `extends` chain. This enables correct type checking across the monorepo.
10. **DO CONFIGURE VITEST/VITE PATHS AND ALIASES EXPLICITLY FOR MONOREPO CONTEXT.** Ensure `resolve.alias` in `vite.config.ts` and `test.server.proxy` in `vitest.config.ts` correctly map module names and paths to respect the monorepo structure and the "Test the Final Product" doctrine. No magic resolution.
11. **DO SEPARATE BUILD OUTPUTS AND TEST ARTIFACTS BY PACKAGE AND TYPE.** Use distinct output directories for each package's build (`shuffrand/dist/`) and for different types of test artifacts (`reports/vitest-bench/`, `reports/playwright/`). This prevents collisions and eases analysis.
12. **DO HARNESS `pnpm`'S WORKSPACE CAPABILITIES FULLY.** Use `pnpm -r` for recursive workspace commands. Use `pnpm --filter` for targeted, package-specific helper scripts. Understand how `pnpm` links dependencies within the workspace and leverage `importer-manifest=package.jsonc` correctly.
13. **DO ALWAYS ADD A TOP-LEVEL COMMENT HEADER IDENTIFYING THE FILE'S LOCATION.** Every source code file (`*.ts`), configuration file (`*.jsonc`, `*.yaml`), and documentation file (`*.md`) must begin with a top-level comment indicating its precise path within the monorepo. This aids navigation and context.
    *   **Examples:**
        *   `// /shuffrand/src.function.crypto-random.ts`
        *   `// ./tsconfig.json | Monorepo configuration`
        *   `// /shuffrand/vite.config.ts | Package build configuration`
        *   `// /.github/ADR/001-versioning-and-codenaming.md`
14. **DO PURGE CACHES AND ARTIFACTS WHEN FACED WITH IRRATIONAL ERRORS.** When a configuration is proven correct but a tool fails irrationally, the problem is often a corrupted state. The correct professional response is a "nuke from orbit": `pnpm store prune` and `rm -rf node_modules pnpm-lock.yaml`. Reset to a clean slate.
15. **DO RUN THE FULL VALIDATION GAUNTLET BEFORE COMMITTING.** Always run `pnpm run preflight`, `pnpm run test:e2e`, and `pnpm run test:benchmark` locally before pushing changes. This ensures the entire toolchain is working correctly and prevents breaking the main branch.
16. ‚≠ê Please, in **all** sincerity, **DO** ask questions or express doubt **right now** (as well as... always?) on things that might be not-the-best practices, anti-patterns, development hell, etc. 